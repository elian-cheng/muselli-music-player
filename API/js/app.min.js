(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);const t="https://muselli-api.glitch.me/";let a=[],c=[];const r=localStorage.getItem("favorite")?JSON.parse(localStorage.getItem("favorite")):[],n=new Audio,l=document.querySelector(".catalog__container"),s=document.querySelector(".header__logo"),o=document.querySelector(".header__favorite_btn"),i=document.querySelector(".player"),d=document.getElementsByClassName("track"),u=document.querySelector(".player__controller-pause"),_=document.querySelector(".player__controller-stop"),m=document.querySelector(".player__controller-prev"),v=document.querySelector(".player__controller-next"),p=document.querySelector(".player__controller-like"),y=document.querySelector(".player__icon_mute"),k=document.querySelector(".player__progress-input"),L=document.querySelector(".track-info_title"),g=document.querySelector(".track-info_artist"),h=document.querySelector(".player__time-passed"),f=document.querySelector(".player__time-total"),S=document.querySelector(".player__volume-input"),E=document.querySelector(".search"),w=document.querySelector(".tracksList-hidden"),q=document.createElement("button");q.classList.add("catalog__btn-add"),q.innerHTML='\n    <span>Увидеть все</span>\n    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8.59 16.59L13.17 12L8.59 7.41L10 6L16 12L10 18L8.59 16.59Z" />\n    </svg>\n';const T=()=>{const e=document.querySelector(".track_active");n.paused?(n.play(),u.classList.remove("player__icon_play"),e.classList.remove("track_pause")):(n.pause(),u.classList.add("player__icon_play"),e.classList.add("track_pause"))},A=e=>{const a=e.currentTarget;if(a.classList.contains("track_active"))return void T();for(let e=0;e<d.length;e++)d[e].classList.remove("track_active-activeColor");a.classList.add("track_active-activeColor");let l=0;const s=a.dataset.idTrack;-1!==r.indexOf(s)?p.classList.add("player__icon_like_active"):p.classList.remove("player__icon_like_active");const o=c.find(((e,t)=>(l=t,s===e.id)));n.src=`${t}${o.mp3}`,L.innerHTML=o.track,g.innerHTML=o.artist,n.play(),u.classList.remove("player__icon_play"),u.classList.add("player__icon_pause"),i.classList.add("player_active"),i.dataset.idTrack=s;const _=0===l?c.length-1:l-1,y=l+1===c.length?0:l+1;p.dataset.idTrack=s,m.dataset.idTrack=c[_].id,v.dataset.idTrack=c[y].id;for(let e=0;e<d.length;e++)s===d[e].dataset.idTrack?d[e].classList.add("track_active"):d[e].classList.remove("track_active")};u.addEventListener("click",T),_.addEventListener("click",(()=>{n.src="",u.classList.add("player__icon_play"),i.classList.remove("player_active"),document.querySelector(".track_active").classList.remove("track_active-activeColor"),document.querySelector(".track_active").classList.remove("track_active")}));const $=e=>{const a=document.createElement("div");return a.style.cursor="pointer",a.classList.add("catalog__tem","track"),i.dataset.idTrack===e.id&&(a.classList.add("track_active"),n.paused&&a.classList.add("track_pause")),a.dataset.idTrack=e.id,a.innerHTML=`\n        <div class="track__img-wrap">\n            <img \n                class="track__poster" \n                src="${t}${e.poster}" \n                alt="${e.artist} ${e.track}"\n                width="180"\n                height="180">\n        </div>\n        <div class="track__info">\n            <p class="track_title">${e.track}</p>\n            <p class="track_artist">${e.artist}</p>\n        </div>\n    `,a},C=(e=null)=>{if(e){c=[...e],l.textContent="";const t=c.map($);l.append(...t),(()=>{for(let e=0;e<d.length;e++)d[e].addEventListener("click",A)})()}else l.textContent="",w.style.display="block",l.style.gridTemplateColumns="auto",l.append(w)},b=(e=1)=>{d[0],l.clientHeight>3*d[0].clientHeight?(d[d.length-e].style.display="none",b(e+1)):1!==e&&l.append(q)},I=()=>{const e=n.duration,t=n.currentTime,a=t/e*k.max;k.value=a||0;const c=Math.floor(t/60)||"0",r=Math.floor(t%60)||"0",l=Math.floor(e/60)||"0",s=Math.floor(e%60)||"0";h.textContent=`${c}:${r<10?"0"+r:r}`,f.textContent=`${l}:${s<10?"0"+s:s}`};const x=()=>{q.addEventListener("click",(()=>{[...d].forEach((e=>{e.style.display="",q.remove()}))}));const e=function(e,t){let a=null;return function(...c){a||(a=setTimeout((()=>{e(...c),clearTimeout(a),a=null}),t))}}(I,500);m.addEventListener("click",A),v.addEventListener("click",A),n.addEventListener("timeupdate",e),n.addEventListener("ended",(()=>{v.dispatchEvent(new Event("click",{bubbles:!0}))})),k.addEventListener("change",(()=>{const e=k.value;n.currentTime=e/k.max*n.duration})),o.addEventListener("click",(()=>{const e=a.filter((e=>r.includes(e.id)));C(e),b()})),s.addEventListener("click",(()=>{C(a),b()})),p.addEventListener("click",(()=>{const e=r.indexOf(p.dataset.idTrack);-1===e?(r.push(p.dataset.idTrack),p.classList.add("player__icon_like_active")):(r.splice(e,1),p.classList.remove("player__icon_like_active")),localStorage.setItem("favorite",JSON.stringify(r))})),S.addEventListener("input",(()=>{const e=S.value;n.volume=e/100})),y.addEventListener("click",(()=>{n.volume?(localStorage.setItem("volume",n.volume),n.volume=0,S.value=0,y.classList.add("player__icon_mute-off")):(y.classList.remove("player__icon_mute-off"),n.volume=localStorage.getItem("volume"),S.value=100*n.volume)})),E.addEventListener("submit",(async e=>{e.preventDefault(),fetch(`${t}api/music?search=${E.search.value}`).then((e=>e.json())).then(C)}))};(async()=>{n.volume=localStorage.getItem("volume")||1,i.volume=100*n.volume,a=await fetch(`${t}api/music`).then((e=>e.json())),C(a),x(),b(),c.length?(C(c),b()):C()})(),window.FLS=!0,function(e){let t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}))})();